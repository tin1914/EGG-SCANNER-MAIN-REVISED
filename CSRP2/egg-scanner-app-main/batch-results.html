<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Results - Fresh Eggs Scanner</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="nav-right">
                    <a href="index.html" class="nav-btn btn-red">Home</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-left">
                        <h1 class="hero-title">
                             Your pocket <span class="text-yellow">Egg-spert in <br>
                            Freshness
                        </h1>
                        <p class="hero-description">
                            Meet your kitchen‚Äôs new best friend! This AI-powered tool scans your eggs and tells you if they‚Äôre fresh, No more egg-speriments gone wrong.
                        </p>
                        <!-- <a href="#upload-section" class="btn btn-red hero-cta">SCAN YOUR EGGS HERE</a>
                        <p class="click-here">Click here!</p> -->
                    </div>
                    <div class="hero-right">
                        <div class="yellow-circle"></div>
                        <div class="egg-bowl">
                            <div class="bowl-container">
                                <div class="bowl"></div>
                                <div class="eggs">
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Process Steps Section -->
        <section class="process-steps">
            <div class="container">
                <div class="steps-grid">
                    <div class="step">
                        <div class="step-icon yellow">1</div>
                        <h3 class="step-title">Upload<br>the Image<br>of the Eggs</h3>
                    </div>
                    <div class="step">
                        <div class="step-icon yellow">2</div>
                        <h3 class="step-title">Wait for the<br>Results</h3>
                    </div>
                    <div class="step">
                        <div class="step-icon green">3</div>
                        <h3 class="step-title">Results Are<br>Ready!</h3>
                    </div>
                </div>
            </div>
        </section>

        <!-- Uploaded Image Viewer Section -->
        <section class="image-viewer-section">
            <div class="container">
                <h2 class="section-title">Scanned Image</h2>
                <div class="image-viewer">
                    <div class="image-container">
                        <img src="https://via.placeholder.com/600x400/FFC107/000000?text=Batch+Eggs+Scan+Result"
                            alt="Uploaded batch eggs scan" class="scanned-image" id="scannedImage">
                        <div class="image-overlay">
                            <button class="zoom-btn" onclick="openImageModal()">üîç View Full Size</button>
                        </div>
                    </div>
                    <p class="image-caption">Your uploaded batch eggs image with scan results</p>
                </div>
            </div>
        </section>

        <!-- Quality Indicators Section -->
        <section class="quality-indicators">
            <div class="container">
                <h2 class="section-title">Batch Scan Results</h2>
                <div class="quality-grid">
                    <!-- Row 1 -->
                    <div class="quality-box medium">
                        <div class="egg-label">EGG 1</div>
                        <div class="quality-label">MEDIUM</div>
                        <div class="quality-details">
                            <div>YOLK 95%</div>
                            <div>EGG WHITE 90%</div>
                        </div>
                    </div>
                    <div class="quality-box fresh">
                        <div class="egg-label">EGG 2</div>
                        <div class="quality-label">FRESH</div>
                        <div class="quality-details">
                            <div>YOLK 95%</div>
                            <div>EGG WHITE 95%</div>
                        </div>
                    </div>

                    <!-- Row 2 -->
                    <div class="quality-box medium">
                        <div class="egg-label">EGG 3</div>
                        <div class="quality-label">MEDIUM</div>
                        <div class="quality-details">
                            <div>YOLK 95%</div>
                            <div>EGG WHITE 85%</div>
                        </div>
                    </div>
                    <div class="quality-box fresh">
                        <div class="egg-label">EGG 4</div>
                        <div class="quality-label">FRESH</div>
                        <div class="quality-details">
                            <div>YOLK 95%</div>
                            <div>EGG WHITE 98%</div>
                        </div>
                    </div>

                    <!-- Row 3 -->
                    <div class="quality-box medium">
                        <div class="egg-label">EGG 5</div>
                        <div class="quality-label">MEDIUM</div>
                        <div class="quality-details">
                            <div>YOLK 80%</div>
                            <div>EGG WHITE 85%</div>
                        </div>
                    </div>
                    <div class="quality-box fresh">
                        <div class="egg-label">EGG 6</div>
                        <div class="quality-label">FRESH</div>
                        <div class="quality-details">
                            <div>YOLK 92%</div>
                            <div>EGG WHITE 96%</div>
                        </div>
                    </div>
                </div>
                
                <div class="gauge-container">
                    <img src="images/gauge.png" alt="Quality Gauge" class="quality-gauge zoomable" loading="lazy">
                </div>
            </div>
        </section>

        <!-- Scan Another Section -->
        <section class="scan-another">
            <div class="container">
                <div class="text-center">
                    <a href="batch-upload.html" class="btn btn-red scan-another-btn">
                        SCAN ANOTHER SET OF EGGS!
                        <span class="arrow">‚Üí</span>
                    </a>
                </div>
            </div>
        </section>

 <!-- Guidelines Section -->
        <section class="guidelines">
            <div class="container">
                
                <!-- Guidelines for Single Egg -->
               <div class="guideline-section">
                    <div class="guideline-header yellow">Guidelines for Single Egg</div>
                    <div class="guideline-content">
                        <div class="guideline-columns-container">
                            <div class="guideline-column">
                                <div class="guideline-content-wrapper">
                                    <div class="guideline-text">
                                        <ol>
                                            <li>Go to a shaded/dark area (the darker it is, the better).</li>
                                            <li>Place Egg On top of a source of light, enough to see the color of the egg inside (Flashlight, Camera light, etc.).</li>
                                             <li>Take a picture of the top view of the lighted/candled egg.</li>
                                            <li>Upload the egg to know the results.</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            <div class="guideline-column">
                                <div class="guideline-content-wrapper">
                                    <div class="guideline-image">
                               <img src="images/SINGLE.png" alt="Single egg example" class="zoomable" loading="lazy">
                            </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Guidelines for Egg Scanning by Batch -->
                <div class="guideline-section">
                    <div class="guideline-header yellow">Guidelines for Egg Scanning by Batch</div>
                    <div class="guideline-content">
                        <div class="guideline-columns-container">
                            <div class="guideline-column">
                                <div class="guideline-content-wrapper">
                                    <div class="guideline-text">
                                        <ol>
                                            <li>Go to a shaded/dark area (the darker it is, the better).</li>
                                            <li>Prepare your DIY Egg Carton with Lights (Scroll down to see the instructions).</li>
                                             <li>Place the eggs on the DIY Egg Carton.</li>
                                            <li>Take a picture of the top view of the lighted/candled eggs.</li>
                                            <li>Upload the picture to know the results.</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            <div class="guideline-column">
                                <div class="guideline-content-wrapper">
                                    <div class="guideline-image">
                               <img src="images/BATCH.png" alt="Batch egg example" class="zoomable" loading="lazy">
                            </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 
                <div class="text-center mb-3">
                    <a href="#upload-section" class="btn btn-red">SCAN YOUR EGGS NOW!</a>
                    <p class="click-here">Click here!</p>
                </div>
                -->
            </div>
        </section>

         <!-- DIY Section -->
        <section class="diy-panel" aria-labelledby="diy-title">
            <div class="container">
                <h2 id="diy-title" class="diy-title">DIY Egg Carton with Lights</h2>

                <div class="diy-card">
                    <div class="diy-steps">
                        <div class="diy-step" aria-label="Step 1: Materials">
                            <div>
                                <div style="display:flex;align-items:flex-start;">
                                    <div class="diy-step-number">1</div>
                                    <div class="diy-text">
                                        <strong>Materials</strong>
                                        <div style="margin-top:6px;font-size:0.95rem;color: #374151;">
                                            Prepare an Egg carton, and 6 small LED lights.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="diy-thumb">
                                <img src="images/STEP 1.png" alt="Materials" class="zoomable" loading="lazy">
                            </div>
                        </div>

                        <div class="diy-step" aria-label="Step 2: Setup">
                            <div>
                                <div style="display:flex;align-items:flex-start;">
                                    <div class="diy-step-number">2</div>
                                    <div class="diy-text">
                                        <strong>Setup</strong>
                                        <div style="margin-top:6px;font-size:0.95rem;color: #374151;">
                                            Cut/Poke small holes under each cell and place the lights underneath.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="diy-thumb">
                                <img src="images/STEP 2.png" alt="Setup" class="zoomable" loading="lazy">
                            </div>
                        </div>

                        <div class="diy-step" aria-label="Step 3: Use">
                            <div>
                                <div style="display:flex;align-items:flex-start;">
                                    <div class="diy-step-number">3</div>
                                    <div class="diy-text">
                                        <strong>Use</strong>
                                        <div style="margin-top:6px;font-size:0.95rem;color: #374151;">
                                            Switch on LED lights, place an egg on each cell, then capture the top view of the lighted eggs.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="diy-thumb">
                                <img src="images/STEP 3.png" alt="Final" class="zoomable" loading="lazy">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <!-- Footer content can be added here if needed -->
            </div>
        </footer>
    </main>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeImageModal()">&times;</span>
            <img id="modalImage" class="modal-image" alt="Full size scanned image">
            <div class="modal-caption">
                <p>Full size view of your batch eggs scan</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Image modal functionality
        function openImageModal() {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const scannedImage = document.getElementById('scannedImage');

            modal.style.display = 'block';
            modalImage.src = scannedImage.src;
            modalImage.alt = scannedImage.alt;

            // Prevent body scrolling when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';

            // Restore body scrolling
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside the image
        document.getElementById('imageModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // Load uploaded image and results
        document.addEventListener('DOMContentLoaded', function () {
            // Load batch results and display them
            const batchResults = localStorage.getItem('batchResults');
            if (batchResults) {
                const data = JSON.parse(batchResults);
                displayBatchResults(data);

                // Use the annotated image from the results
                if (data.annotated_image) {
                    document.getElementById('scannedImage').src = 'data:image/jpeg;base64,' + data.annotated_image;
                } else {
                    // Fallback to placeholder if no annotated image
                    document.getElementById('scannedImage').src =
                        'https://via.placeholder.com/600x400/FFC107/000000?text=Batch+Eggs+Scan+Result';
                }
            } else {
                // Fallback if no batch results
                document.getElementById('scannedImage').src =
                    'https://via.placeholder.com/600x400/FFC107/000000?text=Batch+Eggs+Scan+Result';
            }
        });

        function displayBatchResults(data) {
            const qualityGrid = document.querySelector('.quality-grid');
            qualityGrid.innerHTML = ''; // Clear existing content

            data.results.forEach(result => {
                const qualityBox = document.createElement('div');
                qualityBox.className = `quality-box ${result.label.toLowerCase()}`;

                qualityBox.innerHTML = `
                    <div class="egg-label">EGG ${result.egg_number}</div>
                    <div class="quality-label">${result.label}</div>
                    <div class="quality-details">
                        <div>YOLK ${result.yolk_score}%</div>
                        <div>EGG WHITE ${result.white_score}%</div>
                    </div>
                `;

                qualityGrid.appendChild(qualityBox);
            });
        }
    </script>

    <!-- Image Viewer Modal for Guidelines -->
    <div id="image-viewer" class="image-viewer" aria-hidden="true" role="dialog" aria-label="Image viewer">
        <button class="iv-close" aria-label="Close image viewer">&times;</button>
        <img class="iv-img" src="" alt="">
    </div>

    <script>
        // Image viewer for zoomable guideline images
        (function(){
            const viewer = document.getElementById('image-viewer');
            if (!viewer) return;
            
            const ivImg = viewer.querySelector('.iv-img');
            const ivClose = viewer.querySelector('.iv-close');
            const zoomables = document.querySelectorAll('.zoomable');
            let lastFocused = null;

            function open(src, alt){
                lastFocused = document.activeElement;
                ivImg.src = '';
                ivImg.alt = alt || '';
                viewer.classList.add('show');
                viewer.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                const img = new Image();
                img.onload = function(){
                    ivImg.src = src;
                    ivImg.alt = alt || '';
                    ivClose.focus();
                };
                img.onerror = function(){
                    ivImg.src = src;
                    ivClose.focus();
                };
                img.src = src;
            }
            
            function close(){
                viewer.classList.remove('show');
                viewer.setAttribute('aria-hidden', 'true');
                ivImg.src = '';
                document.body.style.overflow = '';
                if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
            }

            zoomables.forEach(img => {
                img.style.cursor = 'zoom-in';
                img.addEventListener('click', (e) => {
                    const full = img.dataset && img.dataset.full ? img.dataset.full : img.currentSrc || img.src;
                    open(full, img.alt || '');
                    e.stopPropagation();
                });
            });

            ivClose.addEventListener('click', close);
            viewer.addEventListener('click', e => {
                if (e.target === viewer) close();
            });
            ivImg.addEventListener('click', function(e){
                e.stopPropagation();
            });
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape' && viewer.classList.contains('show')) close();
            });
        })();
    </script>
</body>

</html>